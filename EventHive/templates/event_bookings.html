<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Event Bookings - EventHive</title>
  <link rel="stylesheet" href="/static/css/styles.css">
  <script src="/static/js/main.js" defer></script>
</head>
<body>
  <header>
    <h1>EventHive</h1>
    <nav>
      <a href="/organizer.html">Organizer Dashboard</a>
      <a href="/create_event.html">Create Event</a>
      <a href="#" onclick="logoutUser()">Logout</a>
    </nav>
  </header>

  <main>
    <h2>Event Bookings</h2>
    <p id="userInfo"></p>
    
    <label>Select Event</label>
    <select id="eventSelect"></select>

    <h3>Bookings</h3>
    <div id="eventBookings" class="bookings-grid"></div>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const res = await fetch("/events/");
      const events = await res.json();
      const select = document.getElementById("eventSelect");

      events.forEach(ev => {
        const option = document.createElement("option");
        option.value = ev.id;
        option.textContent = `${ev.title} | ${ev.date}`;
        select.appendChild(option);
      });

      select.addEventListener("change", async () => {
        const event_id = select.value;
        const resBookings = await fetch(`/bookings/event/${event_id}`);
        const bookings = await resBookings.json();
        const container = document.getElementById("eventBookings");
        container.innerHTML = "";

        bookings.forEach(b => {
          const div = document.createElement("div");
          div.className = "booking-card";
          div.innerHTML = `
            <p><strong>Booking ID:</strong> ${b.booking_id}</p>
            <p><strong>User ID:</strong> ${b.user_id}</p>
            <p><strong>Tickets:</strong> ${b.quantity} (${b.ticket_type})</p>
            <p><strong>Status:</strong> <span class="status">${b.status}</span></p>
          `;
          container.appendChild(div);
        });
      });

      // Trigger change to load first event bookings
      if (events.length) select.dispatchEvent(new Event("change"));
    });
  </script>
</body>
</html>